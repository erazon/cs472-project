<!doctype html>
<html lang="en">
  <head>
    <title>Cars</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/css/customize.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.12.1/af-2.4.0/b-2.2.3/b-colvis-2.2.3/b-html5-2.2.3/b-print-2.2.3/cr-1.5.6/fc-4.1.0/fh-3.2.3/r-2.3.0/sc-2.0.6/sb-1.3.3/sp-2.0.1/sl-1.4.0/sr-1.1.1/datatables.min.css"/>
 
  </head>
  <body>
    <header class="global-header">
        <div class="container-fluid">
            <%- include('header.html') %>            
        </div>
                
    </header>
  
    <div class="container-fluid">
        <div class="content">
        <div class="col-12 col-md-12 col-lg-12">
            <table id="carList" class="table table-striped table-hover table-bordered table-inverse table-responsive-">
                <thead class="thead-inverse">
                    <tr>
                        <th>New/Used</th>
                        <th>Make</th>
                        <th>Model</th>
                        <th>Price</th>
                        <th>Distance</th>
                        <th>Zip</th>
                        <th class="dt-action-col">Action</th>
                    </tr>
                </thead>
            </table>
            <!-- <nav aria-label="Page navigation">
              <ul class="pagination">
                <li class="page-item disabled">
                  <a class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                  </a>
                </li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item">
                  <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                  </a>
                </li>
              </ul>
            </nav> -->
            <div class="copyright"><p class="mt-5 mb-3 text-muted"><i class="fa fa-copyright" aria-hidden="true"></i>2022 5sCars.com. All rights reserved.</p></div>
        </div>
        
    </div>     
        
    </div>

    <%- include('footer.html') %>

    <script>
    $(document).ready(function () {
        const table = $('#carList').DataTable({
            serverSide: true,
            ajax: {
                url: '/car-list',
                type: 'POST',
                data: {},
                dataSrc: '',
                DT_RowId: 'id',
            },
            columnDefs:[
                {
                    targets: 0,
                    data: 'condition'
                },
                {
                    targets: 1,
                    data: 'make'
                },
                {
                    targets: 2,
                    data: 'model'
                },
                {
                    targets: 3,
                    data: 'price'
                },
                {
                    targets: 4,
                    data: 'distance'
                },
                {
                    targets: 5,
                    data: 'zip'
                },
                {
                    targets: 6,
                    data: null,
                    defaultContent: '<a href="#" class="red"  data-toggle="tooltip" data-placement="top" title="Delete this car"><i class="fa fa-remove" aria-hidden="true"> </i> Delete</a>',
                    sorting: false
                },
            ],
            paging: false,
            searching: false
        });

        $('#carList tbody').on('click', 'a', function (e) {
            const row = table.row($(this).parents('tr'));
            const data = row.data();
            //console.log(data);
            if(confirm('Are you sure delete this car?')){
                // ajax delete data to database
                $.ajax({
                    url : "/delete-car/?id="+data['id'],
                    type: "DELETE"
                }).done((resp)=>{
                    //console.log(resp);
                    //row.remove().draw();
                    if(resp.deleted){
                        //table.ajax.reload();
                        $('#carList').DataTable().ajax.reload()
                    }
                    else{
                        alert('Deletion failed! Something went wrong!');
                    }
                }).fail((err)=>{
                    console.log(err);
                });
            }
            return false;
        });

        $('#carList tbody').on('click', 'td', function () {
            const data = table.row($(this).parents('tr')).data();
            $(location).attr('href', '/add-car?id='+ data['id']);
        });


      });
    </script>